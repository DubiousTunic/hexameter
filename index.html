<html>
	<head>
	</head>
	<body>
		<header>

		</header>
		<div>
			<!--The Homeric Hexameter is called the dactylic hexameter because the basic unit is a
dactyl, which is one long syllable followed by two short syllables (— ‿ ‿). Each unit in
the line consists of either one dactyl or one spondee, which is a foot composed of two
long syllables (— —). There are six (ἕξ) of these units (“feet”) in each line. An exception
is the final foot, which is always two syllables, the first long and the second either long
or short (represented schematically by x). !-->
			<button id="homer">Homer</button>
			<script>
				var audioContext;

				var song;

				document.addEventListener('click', function (event) {

					// If the clicked element doesn't have the right selector, bail
					if (event.target.id !== "homer") return;

					audioContext = AudioContext && new AudioContext();
				
					if(song){
						clearInterval(song);
					}
					else{
						homer(6);
						song = setInterval("homer(6)", 7777) //dactyllic hexameter
					}
					
					// Don't follow the link
					event.preventDefault();					

				}, false);				

				function homer(count){					
					fetch('https://qrng.anu.edu.au/API/jsonI.php?length=1&type=uint8')
					  .then(function(response) {
					    return response.json();
					  })
					  .then(function(myJson) {
					    if(count === 1){
					    	x(function(){
					    		console.log("\n");
					    	});
					    }
					    else if(myJson.data[0] < 170){
					    	dactyl(homer(count-1));
					    }
					    else{
					    	spondee(homer(count-1));
					    }
					  });			  			
				}
			
				//roll for dactyl or spondee
				//hexadecimal roll?

				function dactyl(cb){	
					console.log("dac");								
					beep(777,"triangle",function() {
				        setTimeout(function(){
				        	beep(218, "square", function(){
				        		setTimeout(function(){
				        			beep(333, "square", function(){
				        				setTimeout(cb, 444);
				        			})
				        		}, 444)
				        	})
				        }, 1000)				    
					})
					
				}

				function spondee(cb){
					console.log("spon");
					beep(666,"sawtooth", function(){
						setTimeout(function(){
							beep(777,"triangle",function(){
								setTimeout(cb, 666);
							})
						}, 800);
					})
				}

				function x(cb){
					//first long second long or short
					console.log("x");
					beep(777,"sawtooth",function(){

						setTimeout(function(){
							if(Math.floor(Math.random() * 2 === 0)){
								//short
								beep(228, "sine", function(){
									setTimeout(cb, 323);
								})
							}
							else{
								beep(777, "triangle", function(){
									setTimeout(cb, 778);
								})
							}
						}, 999)					

					})							

				}

				function beep(duration, type, finishedCallback){//amp:0..100, freq in Hz, ms
				  
			

				    duration = +duration;

				    // Only 0-4 are valid types.
				    //type = (type % 5) || "";

				    if (typeof finishedCallback != "function") {
				        finishedCallback = function() {};   
				    }

				    if (! window.AudioContext) {
					    if (! window.webkitAudioContext) {
					        bad_browser();
					        return;
					    }
					    window.AudioContext = window.webkitAudioContext;
					}

					var ctx = new AudioContext();
				    var osc = ctx.createOscillator();

				    osc.type = type;

				    osc.connect(ctx.destination);
				    osc.start();

				    setTimeout(function() {
				        osc.stop(0);
				        finishedCallback();
				    }, duration);
				}
			</script>
		</div>
		<footer>			
		</footer>
	</body>
</html>